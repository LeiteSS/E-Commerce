{"ast":null,"code":"import _regeneratorRuntime from\"/home/ssl/Documents/workspace/e_commerce/e-commerce/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/ssl/Documents/workspace/e_commerce/e-commerce/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import React from'react';import{Typography,Button,Divider}from'@material-ui/core';import{Elements,CardElement,ElementsConsumer}from'@stripe/react-stripe-js';import{loadStripe}from'@stripe/stripe-js';import Review from'./Review';var stripePromise=loadStripe(process.env.REACT_APP_STRIPE_PUBLIC_KEY,true);var PaymentForm=function PaymentForm(_ref){var checkoutToken=_ref.checkoutToken,shippingData=_ref.shippingData,backStep=_ref.backStep,onCaptureCheckout=_ref.onCaptureCheckout,nextStep=_ref.nextStep;var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event,elements,stripe){var cardElement,_yield$stripe$createP,error,paymentMethod,orderData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();if(!(!stripe||!elements)){_context.next=3;break;}return _context.abrupt(\"return\");case 3:cardElement=elements.getElement(CardElement);_context.next=6;return stripe.createPaymentMethod({type:'card',card:cardElement});case 6:_yield$stripe$createP=_context.sent;error=_yield$stripe$createP.error;paymentMethod=_yield$stripe$createP.paymentMethod;if(error){console.log('[error]',error);}else{orderData={line_items:checkoutToken.live.line_items,customer:{firstname:shippingData.firstName,lastname:shippingData.lastName,email:shippingData.email},shipping:{name:'Primary',street:shippingData.address1,town_city:shippingData.city,county_state:shippingData.shippingSubdivision,postal_zip_code:shippingData.zip,country:shippingData.shippingCountry},fulfillment:{shipping_method:shippingData.shippingOption},payment:{gateway:'stripe',stripe:{payment_method_id:paymentMethod.id}}};onCaptureCheckout(checkoutToken.id,orderData);nextStep();}case 10:case\"end\":return _context.stop();}}},_callee);}));return function handleSubmit(_x,_x2,_x3){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Review,{checkoutToken:checkoutToken}),/*#__PURE__*/React.createElement(Divider,null),/*#__PURE__*/React.createElement(Typography,{variant:\"h6\",gutterBottom:true,style:{margin:'20px 0'}},\"Payment method\"),/*#__PURE__*/React.createElement(Elements,{stripe:stripePromise},/*#__PURE__*/React.createElement(ElementsConsumer,null,function(_ref3){var elements=_ref3.elements,stripe=_ref3.stripe;return/*#__PURE__*/React.createElement(\"form\",{onSubmit:function onSubmit(e){return handleSubmit(e,elements,stripe);}},/*#__PURE__*/React.createElement(CardElement,null),/*#__PURE__*/React.createElement(\"br\",null),\" \",/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"div\",{style:{display:'flex',justifyContent:'space-between'}},/*#__PURE__*/React.createElement(Button,{variant:\"outlined\",onClick:backStep},\"Back\"),/*#__PURE__*/React.createElement(Button,{type:\"submit\",variant:\"contained\",disabled:!stripe,color:\"primary\"},\"Pay \",checkoutToken.live.subtotal.formatted_with_symbol)));})));};export default PaymentForm;","map":{"version":3,"sources":["/home/ssl/Documents/workspace/e_commerce/e-commerce/src/components/CheckoutForm/PaymentForm.jsx"],"names":["React","Typography","Button","Divider","Elements","CardElement","ElementsConsumer","loadStripe","Review","stripePromise","process","env","REACT_APP_STRIPE_PUBLIC_KEY","PaymentForm","checkoutToken","shippingData","backStep","onCaptureCheckout","nextStep","handleSubmit","event","elements","stripe","preventDefault","cardElement","getElement","createPaymentMethod","type","card","error","paymentMethod","console","log","orderData","line_items","live","customer","firstname","firstName","lastname","lastName","email","shipping","name","street","address1","town_city","city","county_state","shippingSubdivision","postal_zip_code","zip","country","shippingCountry","fulfillment","shipping_method","shippingOption","payment","gateway","payment_method_id","id","margin","e","display","justifyContent","subtotal","formatted_with_symbol"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Typography, Button, Divider } from '@material-ui/core';\nimport { Elements, CardElement, ElementsConsumer } from '@stripe/react-stripe-js';\nimport { loadStripe } from '@stripe/stripe-js';\n\nimport Review from './Review';\n\nconst stripePromise = loadStripe(process.env.REACT_APP_STRIPE_PUBLIC_KEY, true);\n\nconst PaymentForm = ({ checkoutToken, shippingData, backStep, onCaptureCheckout, nextStep }) => {\n  const handleSubmit = async (event, elements, stripe) => {\n    event.preventDefault();\n\n    if (!stripe || !elements) return;\n\n    const cardElement = elements.getElement(CardElement);\n\n    const { error, paymentMethod } = await stripe.createPaymentMethod({ type: 'card', card: cardElement });\n\n    if (error) {\n      console.log('[error]', error);\n    } else {\n      const orderData = {\n        line_items: checkoutToken.live.line_items,\n        customer: { firstname: shippingData.firstName, lastname: shippingData.lastName, email: shippingData.email },\n        shipping: { \n            name: 'Primary', \n            street: shippingData.address1, \n            town_city: shippingData.city, \n            county_state: shippingData.shippingSubdivision, \n            postal_zip_code: shippingData.zip, \n            country: shippingData.shippingCountry\n        },\n        fulfillment: { shipping_method: shippingData.shippingOption },\n        payment: {\n          gateway: 'stripe',\n          stripe: {\n            payment_method_id: paymentMethod.id,\n          }\n        }\n      }\n\n      onCaptureCheckout(checkoutToken.id, orderData);\n\n      nextStep();\n    }\n  }\n\n  return (\n    <>\n      <Review checkoutToken={checkoutToken} />\n      <Divider />\n      <Typography variant=\"h6\" gutterBottom style={{ margin: '20px 0' }}>Payment method</Typography>\n      <Elements stripe={stripePromise}>\n        <ElementsConsumer>{({ elements, stripe }) => (\n          <form onSubmit={(e) => handleSubmit(e, elements, stripe)}>\n            <CardElement />\n            <br /> <br />\n            <div style={{ display: 'flex', justifyContent: 'space-between' }}>\n              <Button variant=\"outlined\" onClick={backStep}>Back</Button>\n              <Button type=\"submit\" variant=\"contained\" disabled={!stripe} color=\"primary\">\n                Pay {checkoutToken.live.subtotal.formatted_with_symbol}\n              </Button>\n            </div>\n          </form>\n        )}\n        </ElementsConsumer>\n      </Elements>\n    </>\n  );\n};\n\nexport default PaymentForm;\n"]},"metadata":{},"sourceType":"module"}